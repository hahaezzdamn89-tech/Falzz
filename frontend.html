<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Background Remover</title>
<style>
body{margin:0;font-family:system-ui;background:#000;color:#fff;text-align:center;padding:20px;}
input{display:none;}
button{padding:16px 24px;border:none;border-radius:12px;background:#2563eb;color:#fff;font-size:16px;cursor:pointer;margin:8px;}
img{max-width:100%;margin-top:20px;border-radius:12px;}
</style>
</head>
<body>

<h1>AI Background Remover</h1>
<p>Pilih gambar untuk menghapus background otomatis.</p>

<button id="pickFile">Unggah Gambar</button>
<input type="file" id="file" accept="image/*">

<div id="status"></div>
<img id="result" class="hidden">

<button id="downloadBtn" class="hidden">Download Hasil</button>

<script>
const fileInput = document.getElementById('file');
const pickBtn = document.getElementById('pickFile');
const statusDiv = document.getElementById('status');
const resultImg = document.getElementById('result');
const downloadBtn = document.getElementById('downloadBtn');

pickBtn.onclick = () => fileInput.click();

fileInput.onchange = async () => {
  if (!fileInput.files[0]) return;
  statusDiv.textContent = 'Mengupload dan memproses gambar...';

  // Konversi ke URL lokal (Object URL)
  const localUrl = URL.createObjectURL(fileInput.files[0]);

  try {
    // Kirim ke backend
    const res = await fetch('/api/remove-bg', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({image_url: localUrl})
    });

    const data = await res.json();
    if (data.error) {
      statusDiv.textContent = 'Gagal memproses AI: ' + data.error;
      return;
    }

    resultImg.src = data.result_url;
    resultImg.classList.remove('hidden');
    statusDiv.textContent = 'Berhasil!';
    downloadBtn.classList.remove('hidden');
    downloadBtn.onclick = () => {
      const a = document.createElement('a');
      a.href = data.result_url;
      a.download = 'hasil.png';
      a.click();
    };

  } catch(err) {
    statusDiv.textContent = 'Error: ' + err.message;
  }
};
</script>

</body>
</html>